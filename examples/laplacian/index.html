<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>1. Laplacian - MOOSE.jl</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">MOOSE.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li >
                        <a href="../../installation/">Installation</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li class="active">
    <a href="./">1. Laplacian</a>
</li>
                            
<li >
    <a href="../auto_diff/">2. Auto-Diff</a>
</li>
                            
<li >
    <a href="../petsc/">3. PETSc</a>
</li>
                            
<li >
    <a href="../parallel/">4. Parallel</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Systems <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../systems/kernel/">Kernel</a>
</li>
                            
<li >
    <a href="../../systems/boundary_condition/">BoundaryCondition</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../../installation/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../auto_diff/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/friedmud/MOOSE.jl">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#2d-laplacian">2D Laplacian</a></li>
            <li><a href="#start-using-moose">Start Using MOOSE</a></li>
            <li><a href="#the-geometry">The Geometry</a></li>
            <li><a href="#create-the-system">Create the System</a></li>
            <li><a href="#add-variables">Add Variables</a></li>
            <li><a href="#add-kernels">Add Kernels</a></li>
            <li><a href="#boundaryconditions">BoundaryConditions</a></li>
            <li><a href="#initialization">Initialization</a></li>
            <li><a href="#solve">Solve</a></li>
            <li><a href="#output">Output</a></li>
            <li><a href="#final-file">Final File</a></li>
            <li><a href="#running-it">Running It</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="2d-laplacian">2D Laplacian</h1>
<p>As a simple example, let's solve \(-\nabla \cdot \nabla u\) on a square domain, with \(u=0\) on the left and \(u=1\) on the right.  Just a simple Laplacian problem.</p>
<p>(TLDR: If you just want to skip ahead and run it... check out the <code>problems/simple_diffusion</code> directory for a pre-baked script that solves this problem)</p>
<p>To solve this problem we're going to need to:</p>
<ol>
<li>Start <code>using MOOSE</code></li>
<li>Create the Geometry</li>
<li>Create a <code>System</code></li>
<li>Add <code>Variable</code>s to the <code>System</code></li>
<li>Add <code>Kernel</code>s representing our PDE operators acting on our <code>Variable</code>s to the <code>System</code></li>
<li>Add some <code>BoundaryCondition</code> objects for the left and right boundary</li>
<li>Create a <code>Solver</code></li>
<li>Write out the output using <code>VTKOutput</code></li>
<li>Visualize using Paraview: http://www.paraview.org</li>
</ol>
<p>Let's get started.  Fire up a Julia terminal and follow along:</p>
<h2 id="start-using-moose">Start Using MOOSE</h2>
<p>First, we're going to need to use MOOSE:</p>
<pre><code class="julia">using MOOSE
</code></pre>

<h2 id="the-geometry">The Geometry</h2>
<p>Currently, MOOSE.jl only has a simple built-in mesh generator.  Luckily for us, it builds rectangular, 2D domains!</p>
<p>The command is: <code>buildSquare(x_min, x_max, y_min, y_max, n_elems_x, n_elems_y)</code></p>
<p>Let's build a 10x10 grid on the (0,1)x(0,1) unit square:</p>
<pre><code class="julia">mesh = buildSquare(0, 1, 0, 1, 10, 10);
</code></pre>

<h2 id="create-the-system">Create the <code>System</code></h2>
<p>The <code>System</code> holds all of the information about the equations to be solved and geometry.  It must be initialized with a <code>Mesh</code></p>
<p>The only real choice when creating a <code>System</code> is what type to use for the underlying floating point type.  The parametric type you use is either <code>Float64</code> or <code>Dual{N, Float64}</code>.  The choice is dependent on whether you want your Jacobian matrices built from manually coded functions (for <code>Float64</code>) or whether you want to use <a href="../auto_diff/">automatic differentiation (<code>Dual</code>)</a>.</p>
<p>For now, let's use manually coded Jacobian functions:</p>
<pre><code class="julia">diffusion_system = System{Float64}(mesh);
</code></pre>

<h2 id="add-variables">Add <code>Variable</code>s</h2>
<p>A <code>Variable</code> represents a field over the domain you want to solve for.  It's the "u" in the <code>-grad^2 u</code> expression.  Just like that "u" all <code>Variable</code>s have a name ("u", "temperature", "displacement", etc.).  To build our equations we're going to apply operators (called <code>Kernel</code>s) to the <code>Variable</code>s.  But first, we need to add the <code>Variable</code>s to the <code>System</code>.</p>
<p>In our case, we just have one variable named "u":</p>
<pre><code class="julia">u = addVariable!(diffusion_system, &quot;u&quot;);
</code></pre>

<p>That line of code adds a variable named <code>u</code> to the <code>System</code> and returns a handle to it.  We can then use that handle to apply <code>Kernel</code>s and <code>BoundaryCondition</code>s to that <code>Variable</code>.  Let's do that now...</p>
<h2 id="add-kernels">Add <code>Kernel</code>s</h2>
<p>Each term (operator) in your PDE will be represented by one or more <a href="../../systems/kernel/">Kernels</a>.  The \(-\nabla \cdot \nabla\) operator (in weak form) is what is referred to as the <code>Diffusion</code> <code>Kernel</code> in MOOSE.  It's already built-in (see <a href="https://github.com/friedmud/MOOSE.jl/blob/master/src/kernels/Diffusion.jl">src/kernels/Diffusion.jl</a> so the only thing we need to do is apply that operator to our new variable (<code>u</code>):</p>
<pre><code class="julia">addKernel!(diffusion_system, Diffusion(u));
</code></pre>

<p>The <code>Diffusion(u)</code> part of that statement creates a <code>Diffusion</code> <code>Kernel</code> that is acting on our <code>u</code> variable.  It's then added to our <code>diffusion_system</code>.</p>
<p>If we had more terms in our PDE we would continue to call <code>addKernel!()</code>, creating each term and applying it to the appropriate <code>Variable</code>.</p>
<p>This brings up a good point about MOOSE.  All of the objects are "reusable".  The <code>Diffusion</code> <code>Kernel</code> represents the "idea" of the \(-\nabla\cdot\nabla\) operator.  That <code>Diffusion</code> <code>Kernel</code> can be applied to as many variables as you want.  So, if you are solving 16 equations and a \(-\nabla\cdot\nabla\) shows up in each one... then you can apply the same <code>Diffusion</code> operator to each variable.  This gives us a large amount of code reuse and flexibility.</p>
<h2 id="boundaryconditions"><code>BoundaryCondition</code>s</h2>
<p>Now that we've taken care of our PDE operators, we need to handle the boundary conditions <a href="../../systems/boundary_condition/">(BCs)</a>.  We said we wanted \(u=0\) on the left of the domain and \(u=1\) on the right.  A \(u=something\) BC (aka "essential" BC, aka "BC of the first kind", etc.) is a type of <a href="../../systems/boundary_condition/">BoundaryCondition</a> we refer to as a <a href="https://github.com/friedmud/MOOSE.jl/blob/master/src/bcs/DirichletBC.jl">DirichletBC</a>.  Just as with <code>Kernel</code>s we can reuse the same object, applying it on different boundaries with different values.</p>
<p>Speaking of "boundaries"... our built-in mesh generator automatically added some "sidesets" and "nodesets" in our <code>Mesh</code>.  These are sets of boundary geometry that allow us to specify where <code>BoundaryCondition</code>s are applied.  <code>DirichletBC</code> objects operate on "nodesets".</p>
<p>For the built-in mesh generator the sidesets/nodesets are as follows:</p>
<ul>
<li>1: Bottom</li>
<li>2: Right</li>
<li>3: Top</li>
<li>4: Left</li>
</ul>
<p>By applying <code>BoundaryCondition</code> objects to those "boundary IDs" we can select the part of the domain the BC will be applied on.</p>
<p>In our case we need two <code>DirichletBC</code>s... one on the left and one on the right with the proper values:</p>
<pre><code class="julia">addBC!(diffusion_system, DirichletBC(u, [4], 0.0));
addBC!(diffusion_system, DirichletBC(u, [2], 1.0));
</code></pre>

<p>As you can see, a <code>BoundaryCondition</code> (like a <code>Kernel</code>) first takes the <code>Variable</code> it's going to operate on.  Next, comes an array of the boundary IDs it will be applied on and finally, in the case of <code>DirichletBC</code>, the last argument specifies the value to enforce.</p>
<h2 id="initialization">Initialization</h2>
<p>Our set of equations is now complete.  We've created geometry, added operators and set boundary conditions.  Before we can continue we need to <code>initialize!()</code> the <code>System</code>:</p>
<pre><code class="julia">initialize!(diffusion_system);
</code></pre>

<p>This step can do a lot of things... but the main thing it does is distribute all of the Degrees of Freedom (DoFs) corresponding to our <code>Variable</code>s across our <code>Mesh</code>.  The DoFs are the actually finite-element coefficients we'll be solving for in the next step...</p>
<h2 id="solve">Solve</h2>
<p>Now that the problem is setup we need to actually solve the system of equations.  To do that we're going to create a <code>Solver</code> and <code>solve!()</code> it.</p>
<p>For now, we're just going to use a simple, direct, built-in linear solver: <code>JuliaDenseImplicitSolver</code>:</p>
<pre><code class="julia">solver = JuliaDenseImplicitSolver(diffusion_system);
solve!(solver);
</code></pre>

<p>As you can see, we needed to tell it which <code>System</code> to solve... and then call <code>solve!()</code> on the new <code>Solver</code> to actually do the solve.</p>
<h2 id="output">Output</h2>
<p>Once this is complete the solution will be held within the <code>solver</code> object.  To output it to a file so we can view it with <a href="http://www.paraview.org">Paraview</a> we can do:</p>
<pre><code class="julia">out = VTKOutput();
output(out, solver, &quot;simple_diffusion_out&quot;);
</code></pre>

<p>"VTK" is a visualization file format that many third-party visualization tools (such as Paraview) can read.</p>
<h2 id="final-file">Final File</h2>
<p>After all of these steps your file should look like:</p>
<pre><code class="julia">using MOOSE

# Create the Mesh
mesh = buildSquare(0, 1, 0, 1, 10, 10)

# Create the System to hold the equations
diffusion_system = System{Float64}(mesh)

# Add a variable to solve for
u = addVariable!(diffusion_system, &quot;u&quot;)

# Apply the Laplacian operator to the variable
addKernel!(diffusion_system, Diffusion(u))

# u = 0 on the Left
addBC!(diffusion_system, DirichletBC(u, [4], 0.0))

# u = 1 on the Right
addBC!(diffusion_system, DirichletBC(u, [2], 1.0))

# Initialize the system of equations
initialize!(diffusion_system)

# Create a solver and solve
solver = JuliaDenseImplicitSolver(diffusion_system)
solve!(solver)

# Output
out = VTKOutput()
output(out, solver, &quot;simple_diffusion_out&quot;)
</code></pre>

<h2 id="running-it">Running It</h2>
<p>Save the file as <code>diffusion.jl</code> and run it like so:</p>
<pre><code class="bash">julia diffusion.jl
</code></pre>

<p>That last step should have produced a <code>simple_diffusion_out.vtu</code> file in your directory.  You can then use <a href="http://www.paraview.org">Paraview</a> to open the file and view the result:</p>
<p><img alt="Laplacian Visualization" src="../../images/laplacian_viz.png" /></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../mathjax-config.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
